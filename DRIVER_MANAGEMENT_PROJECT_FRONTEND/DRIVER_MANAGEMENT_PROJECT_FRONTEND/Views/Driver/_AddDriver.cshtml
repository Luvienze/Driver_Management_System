@using DRIVER_MANAGEMENT_PROJECT_FRONTEND.Dto.Enum
@using Microsoft.AspNetCore.Mvc.Rendering
@using System.ComponentModel.DataAnnotations
@using System.Reflection

@{
    var genderOptions = Enum.GetValues(typeof(Genders)).Cast<Genders>().Select(g => new SelectListItem
    {
        Value = ((int)g).ToString(),
        Text = g.GetType().GetField(g.ToString())?.GetCustomAttribute<DisplayAttribute>()?.Name ?? g.ToString()
    }).ToList();

    var bloodGroupOptions = Enum.GetValues(typeof(BloodGroups)).Cast<BloodGroups>().Select(bg => new SelectListItem
    {
        Value = ((int)bg).ToString(),
        Text = bg.GetType().GetField(bg.ToString())?.GetCustomAttribute<DisplayAttribute>()?.Name ?? bg.ToString()
    }).ToList();

    var dayOffOptions = Enum.GetValues(typeof(Days)).Cast<Days>().Select(d => new SelectListItem
    {
        Value = ((int)d).ToString(),
        Text = d.GetType().GetField(d.ToString())?.GetCustomAttribute<DisplayAttribute>()?.Name ?? d.ToString()
    }).ToList();

    var cadreOptions = Enum.GetValues(typeof(CadreTypes)).Cast<CadreTypes>().Select(c => new SelectListItem
    {
        Value = ((int)c).ToString(),
        Text = c.GetType().GetField(c.ToString())?.GetCustomAttribute<DisplayAttribute>()?.Name ?? c.ToString()
    }).ToList();
}

@{
    var regNo = User.FindFirst("RegistrationNumber")?.Value;
}

<form id="addDriverForm">
    <div class="modal-body">
        <h6>Personal Informations</h6>
        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="firstName">Firstname</label>
                <input type="text" class="form-control" id="firstName" name="personDto.firstName"
                       required pattern="^[A-Za-zÇçĞğİıÖöŞşÜü\s]+$"
                       title="Only letters and spaces are allowed." />
            </div>
            <div class="form-group col-md-6">
                <label for="lastName">Lastname</label>
                <input type="text" class="form-control" id="lastName" name="personDto.lastName"
                       required pattern="^[A-Za-zÇçĞğİıÖöŞşÜü\s]+$"
                       title="Only letters and spaces are allowed." />
            </div>
        </div>

        <div class="form-row">
            <div class="form-group col-md-4">
                <label for="gender">Gender</label>
                <select class="form-control" id="gender" name="personDto.gender" required>
                    <option value="">Select</option>
                    @foreach (var g in genderOptions)
                    {
                        <option value="@g.Value">@g.Text</option>
                    }
                </select>
            </div>
            <div class="form-group col-md-4">
                <label for="dateOfBirth">Birth Date</label>
                <input type="date" class="form-control" id="dateOfBirth" name="personDto.dateOfBirth"
                       required min="1940-01-01" title="Select date after 1940." />
            </div>
            <div class="form-group col-md-4">
                <label for="phone">Phone Number</label>
                <input type="tel" class="form-control" id="phone" name="personDto.phone"
                       required pattern="^05[0-9]{9}$" maxlength="11" minlength="11"
                       inputmode="numeric", placeholder="05123456789"
                       title="Phone number must start with 05 and be exactly 11 digits." />
            </div>
        </div>

        <div class="form-group">
            <label for="address">Address</label>
            <input type="text" class="form-control" id="address" name="personDto.address" />
        </div>

        <div class="form-row">
            <div class="form-group col-md-4">
                <label for="bloodGroup">Blood Type</label>
                <select class="form-control" id="bloodGroup" name="personDto.bloodGroup" required>
                    <option value="">Select</option>
                    @foreach (var bg in bloodGroupOptions)
                    {
                        <option value="@bg.Value">@bg.Text</option>
                    }
                </select>
            </div>
            <div class="form-group col-md-4">
                <label for="registrationNumber">Registration Number</label>
                <input type="text" class="form-control" id="registrationNumber" name="personDto.registrationNumber"
                       maxlength="6" minlength="6" placeholder="REG000" required />
            </div>
            <div class="form-group col-md-4">
                <label for="dateOfStart">Date of Start</label>
                <input type="date" class="form-control" id="dateOfStart" name="personDto.dateOfStart" required />
            </div>
        </div>

        <div class="form-group">
            <label for="imageUrl">Image URL</label>
            <input type="text" class="form-control" id="imageUrl" name="personDto.imageUrl" readonly />
            <button type="button" id="selectImageBtn" class="btn btn-secondary mt-2">Select Image</button>
            <input type="file" id="fileInput" accept="image/*" style="display:none" />
        </div>


        <input type="hidden" id="isDeleted" name="personDto.isDeleted" value="false" />

        <hr />

        <h6>Driver Information</h6>

        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="garage">Garage</label>
                <input type="text" class="form-control" id="addDriverGarage" name="garage" readonly />
            </div>
            <div class="form-group col-md-6">
                <input type="hidden" id="chiefId" name="driverDto.chiefId" />
            </div>
        </div>

        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="chiefFirstName">Chief Firstname</label>
                <input type="text" class="form-control" id="chiefFirstName" name="driverDto.chiefFirstName" readonly />
            </div>
            <div class="form-group col-md-6">
                <label for="chiefLastName">Chief Lastname</label>
                <input type="text" class="form-control" id="chiefLastName" name="driverDto.chiefLastName" readonly />
            </div>
        </div>

        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="cadre">Cadre</label>
                <select class="form-control" id="cadre" name="driverDto.cadre" required>
                    <option value="">Select</option>
                    @foreach (var c in cadreOptions)
                    {
                        <option value="@c.Value">@c.Text</option>
                    }
                </select>
            </div>
            <div class="form-group col-md-6">
                <label for="dayOff">Day Off</label>
                <select class="form-control" id="dayOff" name="driverDto.dayOff" required>
                    <option value="">Select</option>
                    @foreach (var d in dayOffOptions)
                    {
                        <option value="@d.Value">@d.Text</option>
                    }
                </select>
            </div>
        </div>

        <div class="form-group form-check">
            <input type="checkbox" class="form-check-input" id="isActive" name="driverDto.isActive" checked />
            <label class="form-check-label" for="isActive">Active</label>
        </div>
    </div>
</form>
<script>window.currentUserRegistrationNumber = '@regNo';</script>
